# Donation Svelte: Logging in

We already have a login form:

![](img/07.png)

Currently it is not connected to the Donation API:

~~~html
<script lang="ts">
  import { goto } from "$app/navigation";
  import { loggedInUser } from "$lib/stores";
  import Message from "$lib/ui/Message.svelte";
  import UserCredentials from "$lib/ui/UserCredentials.svelte";

  let email = "";
  let password = "";
  let message = "";

  async function login() {
    const success = true;
    if (success) {
      loggedInUser.set(email);
      goto("/donate");
    } else {
      email = "";
      password = "";
      message = "Invalid Credentials";
    }
  }
</script>

{#if message}
  <Message {message} />
{/if}
<form on:submit|preventDefault={login}>
  <UserCredentials bind:email bind:password />
  <button class="button is-success is-fullwidth">Log In</button>
</form>
~~~

We can now adapt this to log in using the donationService object. First, though,  we are going to set up a [Svelte Store](https://svelte.dev/docs/svelte-store):

### src/lib/stores.ts

~~~typescript
import { writable } from "svelte/store";
import type { Session } from "./services/donation-types";

export const currentSession = writable<Session>();
~~~

This will store details we retrieve from donation-web when we have successfully authenticated.

Now we can implement the login() method:

### src/lib/routes/login/LoginForm.ts

~~~typescript
  import { goto } from "$app/navigation";
  import { donationService } from "$lib/services/donation-service";
  import { currentSession } from "$lib/stores";
  import Message from "$lib/ui/Message.svelte";
  import UserCredentials from "$lib/ui/UserCredentials.svelte";

  let email = "";
  let password = "";
  let message = "";

  async function login() {
    console.log(`attemting to log in email: ${email} with password: ${password}`);
    let session = await donationService.login(email, password);
    if (session) {
      currentSession.set(session);
      goto("/donate");
    } else {
      email = "";
      password = "";
      message = "Invalid Credentials";
    }
  }
~~~

The logged in user details can be displayed in the main menu:

### src/lib/ui/menu.svelte

~~~html
<script lang="ts">
  import { currentSession } from "$lib/stores";
</script>
...
   <a class="navbar-item" href="/logout"> Logout [{$currentSession?.name}]</a>
...
~~~

... and logging out can clear the details by calling logout on the donationService object and redirecting to the start page:

### src/routes/logout/+page.svelte

~~~html
<script lang="ts">
  import { goto } from "$app/navigation";
  import { donationService } from "$lib/services/donation-service";

  donationService.logout();
  goto("/");
</script>
~~~

